# Flask Mailing App
Простое приложение для проведения рассылок по электронной почте.
Список адресов электронной почты и текст рассылки считываются из двух файлов, имена которых хранятся в переменной среды.
Валидность введенных адресов электронной почты проверяется приложением.
Для рассылки используется SMTP-сервер Google, позволяющий бесплатно отправлять 
до 100 email-сообщений в сутки.

### Требования
1. Docker version 20.10.21
2. Аккаунт Google - требуется сгенерировать пароль для приложения на
соответствующей странице сервиса (перед этим потребуется подключить 
двухфакторную аутентификацию):
https://myaccount.google.com/apppasswords

### Инструкция по запуску
1. Клонируем репозиторий и переходим в директорию проекта
```sh
git clone git@github.com:artemyev1003/mailing_app.git
cd mailing_app
```
2. Определяем переменные среды 
- MAIL_USERNAME - адрес электронной почты (Google), с которого будет осуществляться рассылка
- MAIL_PASSWORD - пароль приложения, сгенерированный Google-аккаунтом
- RECIPIENTS_FILE - адрес файла со списком email-адресов для рассылки, каждый адрес на новой строке
  (в качестве примера создан файл /data/recipients.txt)
- TEXT_FILE - адрес файла с текстом рассылки. Первая строка - тема письма, 
последующие - текст (в качестве примера создан файл data/email_text.txt)
```sh
echo MAIL_USERNAME = ... > .env.dev
echo MAIL_PASSWORD = ... >> .env.dev
echo RECIPIENTS_FILE =... >> .env.dev
echo TEXT_FILE =... >> .env.dev

```
3. Собираем образ и запускаем контейнер 
```sh
docker build -t mailing .
docker run -p 5000:5000 -v $(pwd)/data:/data mailing   
```

4. Запускаем рассылку с помощью GET-запроса к эндпойнту ```/send-mail```:
```sh
curl http://localhost:5000/send-mail
```

### Автоматизация запуска рассылки
Для настройки периодического запуска рассылки можно воспользоваться
стандартным планировщиком задач ```cron```.
Запускаем bash-скрипт, создающий новую задачу cron для отправки запроса, 
инициирующего email-рассылку каждый день в 8:00:
```bash
bash create_cron_job.sh
```

Для удаления задачи:
```sh
crontab -r
```